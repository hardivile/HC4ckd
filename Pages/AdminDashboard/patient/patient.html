<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Patients - AI4CKD</title>
    <link rel="stylesheet" href="patient.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.16.0/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@^1.16.0/dist/pdf-lib.min.js"></script>
    <script src="../auto-tasks.js" defer></script> <!-- Contient generatePatientReport -->
    <script src="patient.js" defer></script>
</head>
<body>
    <div class="sidebar">
        <h2>AI4CKD</h2>
        <ul>
            <li><a href="../dashboard.html">üìä Tableau de bord</a></li>
            <li><a href="patient.html" class="active">üë• Patients</a></li>
            <li><a href="../Rendez-vous/rendezvous.html">Rendez-vous</a></li>
            <li><a href="#">‚öôÔ∏è Param√®tres</a></li>
        </ul>
    </div>
    
    <div class="main-content">
        <header>
            <div class="search-container">
                <input type="text" id="search" placeholder="üîç Rechercher un patient..." aria-label="Rechercher un patient">
            </div>
            <div class="profile">üë®‚öïÔ∏è Dr. Dupont</div>
        </header>
        
        <section class="patient-management">
            <div class="section-header">
                <h2>Gestion des Patients</h2>
                <button id="generateAllPdf" class="pdf-btn">üìÑ Exporter tous les PDF</button>
            </div>
            
            <div class="form-container">
                <h3>Ajouter un nouveau patient</h3>
                <form id="patientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="lastName">Nom:</label>
                            <input type="text" id="lastName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="firstName">Pr√©nom:</label>
                            <input type="text" id="firstName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="age">√Çge:</label>
                            <input type="number" id="age" required min="0" max="120">
                        </div>
                            
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" required>
                        </div>

                        <div class="form-group">
                            <label for="ckdStage">Stade MRC:</label>
                            <select id="ckdStage" required>
                                <option value="">S√©lectionner...</option>
                                <option value="1">Stade 1</option>
                                <option value="2">Stade 2</option>
                                <option value="3">Stade 3</option>
                                <option value="4">Stade 4</option>
                                <option value="5">Stade 5</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastExam">Dernier examen:</label>
                            <input type="date" id="lastExam" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="submit-btn" >Enregistrer</button>
                        <button type="reset" class="cancel-btn">Annuler</button>
                    </div>
                </form>
            </div>
            
            <div class="patient-list">
                <h3>Liste des Patients</h3>
                <div class="table-responsive">
                    <table aria-label="Liste des patients">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Pr√©nom</th>
                                <th>√Çge</th>
                                <th>Stade MRC</th>
                                <th>Dernier Examen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patientList">
                            <!-- Les patients seront ajout√©s ici dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
    
    
    
    <script>
        // Script pour le bouton "Exporter tous les PDF"
        document.getElementById('generateAllPdf').addEventListener('click', function() {
            const patients = JSON.parse(localStorage.getItem('patients')) || [];
            if (patients.length === 0) {
                alert("Aucun patient √† exporter");
                return;
            }
            
            if (confirm(`Exporter ${patients.length} rapports PDF ?`)) {
                patients.forEach(patient => {
                    if (window.generatePatientReport) {
                        setTimeout(() => {
                            generatePatientReport(patient);
                        }, 1000); // D√©lai pour √©viter le blocage navigateur
                    }
                });
            }
        });
    </script>
</body>
</html>